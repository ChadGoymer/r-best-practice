<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>R Best Practice</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R Best Practice</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="software.html">Software</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Code
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="r-code-style.html">Style</a>
    </li>
    <li>
      <a href="r-code-structure.html">Structure</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="packages-wrangling.html">Data Wrangling</a>
    </li>
    <li>
      <a href="packages-modelling.html">Modelling</a>
    </li>
    <li>
      <a href="packages-visualisation.html">Visualisation</a>
    </li>
    <li>
      <a href="packages-optimisation.html">Optimisation</a>
    </li>
    <li>
      <a href="packages-development.html">Package development</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Development
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="development-version-control.html">Version Control</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">R Best Practice</h1>

</div>


<p>This document sets out the proposals for best practice when using R. The aim is to provide a consistent and comprehensive approach to using R for analysis and applications. It forms part of the wider guidance on end-user computing, where the focus is on the following areas:</p>
<ul>
<li>Risk analysis</li>
<li>Documentation</li>
<li>Testing</li>
<li>Reproducibility</li>
<li>Change control</li>
<li>Access control</li>
</ul>
<p>This document will expand upon those areas by recommending the software to install; the style and structure to use when writing R code; the recommended packages for achieving common tasks; and a guide for developing R packages to share code in a robust manner.</p>
<div id="risk-analysis" class="section level2">
<h2>Risk Analysis</h2>
<p>The level of documentation, testing and change control depends on two factors:</p>
<ol style="list-style-type: decimal">
<li>Complexity</li>
<li>Criticality</li>
</ol>
<p><strong>Complexity:</strong> If a piece of work is very simple it may only require a short description, a manual test and saving to a secure location. However, if it is highly complex it is important for others, and your future self, to document it thoroughly, provide repeatable tests and save the scripts in version control.</p>
<p><strong>Criticality:</strong> If a piece of work is a simple analysis for curiosity it may not need any controls applied to it. However, if it provides functionality which other systems rely on or informs major business decisions then it is important to ensure it is thoroughly tested and reviewed and changes are not made without careful consideration of how it affects dependents.</p>
<p>In order to assess the level of controls perform a simple risk analysis by estimating the level of complexity and criticality of the work, using a scale of <strong>high</strong>, <strong>medium</strong> or <strong>low</strong>. If both are low then no further consideration is required. However, If any of the above factors are medium or high then the work is considered material and should be subject to the following controls.</p>
</div>
<div id="documentation" class="section level2">
<h2>Documentation</h2>
<p>As a minimum the following should be documented with the code. For simple scripts, a commented header in the file is sufficient. For multi-file applications it is recommended that a <a href="r-code-structure.html#README">README</a> file is added.</p>
<ul>
<li>Name</li>
<li>Description</li>
<li>Purpose</li>
<li>Instructions</li>
</ul>
<p>For high <strong>complexity</strong> work the following should be considered</p>
<ul>
<li>Write documentation for each section/function of code separately</li>
<li>Provide examples</li>
</ul>
<p>For high <strong>criticality</strong> work consider creating an <a href="packages-development.html">R package</a> then:</p>
<ul>
<li>Create a <a href="packages-development.html#description">DESCRIPTION</a> file to document the package.</li>
<li>Use the R package <a href="packages-development.html#documenation"><code>Roxygen2</code></a> to document functions.</li>
<li>Write a <a href="packages-development.html#vignette">vignette</a> explaining its use.</li>
</ul>
</div>
<div id="testing" class="section level2">
<h2>Testing</h2>
<p>As a minimum, manual tests should be performed and the results recorded alongside the code. This may take the following forms:</p>
<ul>
<li>Assertions in the code to ensure reasonableness, e.g.Â result is within a range.</li>
<li>Comparisons with known results.</li>
</ul>
<p>For high <strong>complexity</strong> work consider the following:</p>
<ul>
<li>Separate tests for each section/function of code.</li>
<li>Comparisons with simple inputs and expected results</li>
</ul>
<p>For high <strong>criticality</strong> work consider creating an <a href="packages-development.html">R package</a> then:</p>
<ul>
<li>Use the R package <a href="packages-development.html#testing"><code>testthat</code></a> to write executable tests.</li>
<li>Execute regression tests whenever changes are made.</li>
<li>Perform integration tests with dependent systems.</li>
</ul>
</div>
<div id="reproducibility" class="section level2">
<h2>Reproducibility</h2>
<p>Important work should reproducible by others, and your future self. This means keeping track of inputs, parameters and code used to produce results. The simplest approach is to keep a copy of input data and parameters alongside the the code used to produce the saved results. Then it is self-contained.</p>
<p>Also consider using <a href="r-code-style.html#r-markdown">R markdown</a> which captures description, code and results in a single document.</p>
<p>For high <strong>complexity</strong> work consider creating an <a href="r-code-structure.html#projects">RStudio project</a> it has the following benefits:</p>
<ul>
<li>Sets the current working directory so relative file paths can be used.</li>
<li>Saves open files so you can start where you left off.</li>
</ul>
<p>Some other recommendations worth considering are:</p>
<ul>
<li>Avoid referencing external files if possible.</li>
<li>Make dependencies clear.</li>
<li>Cache versions of input data into a subfolder, if not large.</li>
</ul>
<p>For high <strong>Criticality</strong> work also consider</p>
<ul>
<li>Outputting audit logs with time stamp, username and computing environment</li>
<li>Holding inputs in version control</li>
</ul>
</div>
<div id="change-control" class="section level2">
<h2>Change control</h2>
<p>Change control is about managing updates and bug fixes to the code in a way that is tracked, reviewed, and approved. It ensures change, and its implications, is understood and can also be reversed, if necessary. The simplest approach is to produce new files for each version, keeping older versions elsewhere. Each new version should document the reason for the change.</p>
<p>A much better solution is to use version control software to track changes. This makes the process much more robust. It is recommended that <a href="development.html#git">Git</a> is used for version control and shared using a hosting application such as GitHub (or TFS if not available).</p>
<p>For high <strong>complexity</strong> and/or <strong>criticality</strong> consider the following:</p>
<ul>
<li>Track changes in the hosting application (GitHub or TFS).</li>
<li>Record description and reason for change and prioritise.</li>
<li>Create a new branch for each change.</li>
<li>Merge back into the main branch only after a review.</li>
<li>Require approval from an appropriate person or group before releasing to production.</li>
</ul>
</div>
<div id="access-control" class="section level2">
<h2>Access control</h2>
<p>There should be appropriate controls on who has access to the source code and/or results. The developers should be aware of who has access the work they are producing. The simplest approach is to save files into a location with adequate access controlled by the IT dept. It may also be appropriate to limit who has the ability to change the source code separately.</p>
<p>For high <strong>complexity</strong> work it is important only those with the appropriate level of knowledge can change the code.</p>
<p>For high <strong>criticality</strong> work production code should not be changable directly. A release process should be set up so appropriate approval must be given before code is promoted.</p>
<p>In both cases:</p>
<ul>
<li>The list of people with access to the source code and results should be reviewed on a regular basis.</li>
<li>Appropriate back up and recovery strategies should be implemented to ensure rollback and re-installation is possible.</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
