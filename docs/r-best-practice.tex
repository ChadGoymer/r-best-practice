\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={R Best Practice},
            pdfauthor={Chad Goymer},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\usepackage[normalem]{ulem}
% avoid problems with \sout in headers with hyperref:
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{R Best Practice}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Chad Goymer}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{2019-03-06}

\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

This document sets out the recommendations for best practice when using R. The aim is to provide
a consistent and comprehensive approach to using R for analysis and applications. It forms
part of the wider guidance on end-user computing. The document is split into the following
areas:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{\href{software.html}{Recommended Software}}: Details the recommended software to install, both
  the core R applications and supporting software.
\item
  \textbf{\href{writing.html}{Writing R Code}}: Gives guidance on on how to write R scripts and
  applications.
\item
  \textbf{\href{packages.html}{Recommended Packages}}: Lists the recommended packages to use for achieving
  common tasks.
\item
  \textbf{\href{development.html}{Development Practices}}: Describes the recommended approaches to
  developing in R.
\end{enumerate}

This document is not supposed to be a comprehensive guide to using R. It gives guidance
and sign-posts users to resources with more details.

\hypertarget{end-user-computing}{%
\section{End-User Computing}\label{end-user-computing}}

The Bank of England's 2016 report
\href{https://www.bankofengland.co.uk/-/media/boe/files/prudential-regulation/publication/solvency-ii-internal-model-approved-process-data-review-findings-09-02-2016.pdf?la=en\&hash=873ED57439F79A32D0F00D7255BC0E436E9F85E5}{\emph{Solvency II: internal model approval process data review findings}}
identifies end-user computing as a Solvency II risk. In particular, it states:

\begin{quote}
Spreadsheets and other user-developed applications are a form of information technology,
and all information technology needs to be appropriately controlled.
\end{quote}

End-user computing requires a user to think about the following areas when developing
in R:

\begin{itemize}
\tightlist
\item
  Documentation
\item
  Testing
\item
  Reproducibility
\item
  Change control
\item
  Access control
\end{itemize}

The degree to which the above points need to be addressed depend on the result of a simple risk
analysis. For example, if a piece of work is a one-off analysis and the results are not distributed
further, then some simple documentation is all that is required. If the work is a complex set of
functions, which important systems depend on, then each function must be clearly documented and
user guides specified.

More detail is given on each of the areas below.

\hypertarget{risk-analysis}{%
\section{Risk Analysis}\label{risk-analysis}}

The level of documentation, testing and change control depends on two factors:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Complexity
\item
  Criticality
\end{enumerate}

\textbf{Complexity:} If a piece of work is very simple it may only require a short
description, a manual test and saving to a secure location. However, if it is highly
complex it is important for others, and your future self, to document it thoroughly,
provide repeatable tests and save the scripts in version control.

\textbf{Criticality:} If a piece of work is a simple analysis for curiosity it may not
need any controls applied to it. However, if it provides functionality which other
systems rely on or informs major business decisions then it is important to ensure
it is thoroughly tested and reviewed and changes are not made without careful
consideration of how it affects dependents.

In order to assess the level of controls our end-user computing standards require we perform a
simple risk analysis by estimating the level of \emph{complexity} and \emph{criticality} of the work,
using a scale of \textbf{high}, \textbf{medium} or \textbf{low}. If both are low then no further consideration
is required. However, if any of the above factors are \emph{medium} or \emph{high} then the work is
considered material and the following recommendations should be considered.

\hypertarget{documentation}{%
\section{Documentation}\label{documentation}}

Documentation ensures everyone using the code understands what it does and how to use it
effectively. For simple scripts, a commented header in the file is sufficient. For multi-file
applications it is recommended that a separate
\href{http://r-pkgs.had.co.nz/release.html\#readme}{README} text file is added.

\hypertarget{low-complexity-and-criticality}{%
\subsubsection{Low Complexity and Criticality}\label{low-complexity-and-criticality}}

As a minimum, it is recommended that the following are documented with the code:

\begin{itemize}
\tightlist
\item
  Record the \textbf{name} of the project, analysis or application.
\item
  Write a \textbf{description} of of what the code does (not how).
\item
  Record the \textbf{purpose} of the code.
\item
  Write \textbf{instructions} for how to use the code.
\end{itemize}

\hypertarget{medium-complexity}{%
\subsubsection{Medium Complexity}\label{medium-complexity}}

As the complexity increases it becomes important to ensure users know how to use the code
correctly. In addition to the list above, the following is also recommended:

\begin{itemize}
\tightlist
\item
  Provide \textbf{examples} of usage.
\end{itemize}

\hypertarget{high-complexity}{%
\subsubsection{High Complexity}\label{high-complexity}}

For high complexity work it is important that the code is broken up into sections or functions.
Therefore the following are recommended:

\begin{itemize}
\tightlist
\item
  Write \textbf{separate descriptions} for each section or function.
\item
  Provide \textbf{separate examples} for each section or function.
\item
  Write a \textbf{user guide}
\end{itemize}

\hypertarget{medium-criticality}{%
\subsubsection{Medium Criticality}\label{medium-criticality}}

As criticality increases it becomes important to ensure reproducibility is possible. Therefore,
in addition to the minimum requirements above, following is recommended:

\begin{itemize}
\tightlist
\item
  Clearly define \textbf{dependencies} (packages used, input data used,\ldots{}etc).
\end{itemize}

\hypertarget{high-criticality}{%
\subsubsection{High Criticality}\label{high-criticality}}

For high criticality work consider creating an \href{http://r-pkgs.had.co.nz/}{R package} then:

\begin{itemize}
\tightlist
\item
  \textbf{Document the package} by creating a \href{http://r-pkgs.had.co.nz/description.html}{DESCRIPTION}.
\item
  \textbf{Document each function} using \href{http://r-pkgs.had.co.nz/man.html}{\texttt{Roxygen2}}.
\item
  Write a \textbf{user guide} as a \href{http://r-pkgs.had.co.nz/vignettes.html}{vignette} explaining
  its use.
\end{itemize}

\hypertarget{testing}{%
\section{Testing}\label{testing}}

Testing is required to ensure the code actually does what is intended. It is also necesary to
record the tests, so they can be repeated, and the results, as evidence of correctness.

\hypertarget{low-complexity-and-criticality-1}{%
\subsubsection{Low Complexity and Criticality}\label{low-complexity-and-criticality-1}}

As a minimum, manual tests should be performed to ensure the user is comfortable the code is
working as intended. In order to reproduce the tests it is recommended the following are
recorded:

\begin{itemize}
\tightlist
\item
  Describe the \textbf{test process}.
\item
  Record the \textbf{test results}.
\end{itemize}

\hypertarget{medium-complexity-1}{%
\subsubsection{Medium Complexity}\label{medium-complexity-1}}

As the complexity increases it becomes more important to ensure the code is tested, consider:

\begin{itemize}
\tightlist
\item
  \textbf{Comparisons} with known results.
\item
  \textbf{Regression tests} to compare new results to previous ones.
\end{itemize}

\hypertarget{high-complexity-1}{%
\subsubsection{High Complexity}\label{high-complexity-1}}

For high complexity work it is important that the code is broken up into sections or
functions. Therefore, following are recommended:

\begin{itemize}
\tightlist
\item
  \textbf{Separate tests} for each section or function.
\item
  \textbf{Unit tests} to compare with expected results when given simple inputs.
\end{itemize}

\hypertarget{medium-criticality-1}{%
\subsubsection{Medium Criticality}\label{medium-criticality-1}}

As the criticality increases checks should be added within the code. This ensures the code and
the results are tested each time it is run. The following are also recommended:

\begin{itemize}
\tightlist
\item
  \textbf{Assertions on the inputs} to ensure they are valid for the code (e.g.~a particular value is
  positive).
\item
  Check \textbf{appropriate errors or warnings} are returned when inputs are invalid.
\end{itemize}

\hypertarget{high-criticality-1}{%
\subsubsection{High Criticality}\label{high-criticality-1}}

For high criticality work consider creating an \href{pkg_book}{R package} then:

\begin{itemize}
\tightlist
\item
  \textbf{Test the package} using \href{http://r-pkgs.had.co.nz/tests.html}{\texttt{testthat}} to write
  executable tests.
\item
  Execute \textbf{regression tests} whenever changes are made.
\item
  Perform \textbf{integration tests} with dependent systems.
\end{itemize}

\hypertarget{reproducibility}{%
\section{Reproducibility}\label{reproducibility}}

Important work should reproducible by others, and your future self. This means keeping
track of inputs, parameters and code used to produce results.

\hypertarget{low-complexity-and-criticality-2}{%
\subsubsection{Low Complexity and Criticality}\label{low-complexity-and-criticality-2}}

As a minimum, it should be clear where the inputs came from. The following are recommended:

\begin{itemize}
\tightlist
\item
  Clearly define how to \textbf{import input data} so it can be re-executed.
\item
  Consider keeping a \textbf{copy of input data and parameters} alongside the code.
\end{itemize}

\hypertarget{medium-complexity-2}{%
\subsubsection{Medium Complexity}\label{medium-complexity-2}}

As the complexity increases consider using a structured project, for example.

\begin{itemize}
\tightlist
\item
  Use
  \textbf{\href{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}{RStudio projects}},
  which allows you to reference files
  using relative paths and save open files and workspaces.
\item
  Consider using \textbf{\href{https://rmarkdown.rstudio.com/lesson-1.html}{R markdown}} which captures
  description, code and results in a single document.
\end{itemize}

\hypertarget{high-complexity-2}{%
\subsubsection{High Complexity}\label{high-complexity-2}}

For high complexity work it the following are recommended:

\begin{itemize}
\tightlist
\item
  It is \textbf{peer reviewed}. The best way to ensure others can reproduce your work is to get a peer
  review.
\item
  \textbf{Avoid referencing external files}, unless you can be positive they will always be available
  in the specified location. Even then, it is worth \textbf{caching external files} in a subfolder, if
  they are not too large.
\end{itemize}

\hypertarget{medium-criticality-2}{%
\subsubsection{Medium Criticality}\label{medium-criticality-2}}

As the criticality increases following is recommended:

\begin{itemize}
\tightlist
\item
  Output an \textbf{audit log} with a time stamp, username of the person executing the code and a
  summary of computing environment (e.g.~package versions used).
\end{itemize}

\hypertarget{high-criticality-2}{%
\subsubsection{High Criticality}\label{high-criticality-2}}

For high criticality work also consider:

\begin{itemize}
\tightlist
\item
  Holding \textbf{inputs in version control} or other system that allows you to retrieve old versions.
\item
  Using \href{https://rstudio.github.io/packrat/}{packrat} to \textbf{manage the versions of packages} used.
\end{itemize}

\hypertarget{change-control}{%
\section{Change control}\label{change-control}}

Change control is about managing updates and bug fixes to the code in a way that is
tracked, reviewed, and approved. It ensures change, and its implications, is understood
and can also be reversed, if necessary.

\hypertarget{low-complexity-and-criticality-3}{%
\subsubsection{Low Complexity and Criticality}\label{low-complexity-and-criticality-3}}

The simplest approach is to:

\begin{itemize}
\tightlist
\item
  Produce \textbf{new files for each version}.
\item
  \textbf{Archive older versions} so you can rollback is necessary.
\item
  \textbf{Document changes}, concentrating on why rather than what.
\end{itemize}

\hypertarget{medium-complexity-3}{%
\subsubsection{Medium Complexity}\label{medium-complexity-3}}

As complexity increases it becomes more important to track changes in a more robust manner.
Instead of the approach above:

\begin{itemize}
\tightlist
\item
  Use \textbf{version control software}, such as \href{https://git-scm.com/about}{Git}, to track changes.
\end{itemize}

\hypertarget{high-complexity-3}{%
\subsubsection{High Complexity}\label{high-complexity-3}}

\begin{itemize}
\tightlist
\item
  \textbf{Break changes down into tasks} and implement each one separately.
\item
  Create a \textbf{branch for each task} and merge back into the main branch once complete.
\end{itemize}

\hypertarget{medium-criticality-3}{%
\subsubsection{Medium Criticality}\label{medium-criticality-3}}

As criticality increases it becomes more important to confirm changes are correct and
appropriate.

\begin{itemize}
\tightlist
\item
  Use \textbf{version control software}, such as \href{https://git-scm.com/about}{Git}, to track changes.
\item
  Ensure \textbf{changes are peer reviewed} and documented.
\end{itemize}

\hypertarget{high-criticality-3}{%
\subsubsection{High Criticality}\label{high-criticality-3}}

\begin{itemize}
\tightlist
\item
  Use \textbf{version control hosting application}, such as \href{https://help.github.com/}{GitHub} or
  Microsoft's \href{https://azure.microsoft.com/en-us/product-categories/devops/}{Azure DevOps}, to
  share changes.
\item
  \textbf{Formalise reviews} using
  \href{https://help.github.com/articles/about-pull-requests/}{pull requests}.
\item
  \textbf{Require approval} from an appropriate person or group before deploying to production.
\end{itemize}

\hypertarget{access-control}{%
\section{Access control}\label{access-control}}

There should be appropriate controls on who has access to the source code and/or results.
The developers should be aware of who has access the work they are producing.

\hypertarget{low-complexity-and-criticality-4}{%
\subsubsection{Low Complexity and Criticality}\label{low-complexity-and-criticality-4}}

The simplest approach is:

\begin{itemize}
\tightlist
\item
  Save files to a network drive, with \textbf{access controlled} by the IT dept.
\end{itemize}

\hypertarget{medium-complexity-4}{%
\subsubsection{Medium Complexity}\label{medium-complexity-4}}

As complexity increases it is important to ensure that no unintentional changes are propagated
into production.

\begin{itemize}
\tightlist
\item
  \textbf{Separate source code} from results.
\item
  \textbf{Maintain a protected version}, which can only be updated by appropriate people
  (Note: GitHub provides this functionality out-of-the-box).
\end{itemize}

\hypertarget{high-complexity-4}{%
\subsubsection{High Complexity}\label{high-complexity-4}}

For high complexity work it is important only those with the appropriate level of
knowledge can change the code.

\begin{itemize}
\tightlist
\item
  Use \textbf{version control hosting application}, such as \href{https://help.github.com/}{GitHub} or
  Microsoft's \href{https://azure.microsoft.com/en-us/product-categories/devops/}{Azure DevOps}, to
  share changes.
\item
  Deploy to a \textbf{production location} for users.
\end{itemize}

\hypertarget{medium-criticality-4}{%
\subsubsection{Medium Criticality}\label{medium-criticality-4}}

As criticality increases is important to ensure work is protected and backed up.

\begin{itemize}
\tightlist
\item
  Ensure an appropriate \textbf{back-up and recovery strategy} is in place.
\item
  Ensure that the code has gone through an \textbf{appropriate review} before deploying to production.
\end{itemize}

\hypertarget{high-criticality-4}{%
\subsubsection{High Criticality}\label{high-criticality-4}}

For high criticality work production code should not be changable directly. A release
process should be set up so appropriate approval must be given before code is promoted.

\begin{itemize}
\tightlist
\item
  Maintain and \textbf{regularly review the list of developers} and users.
\item
  Ensure that the code has gone through an \textbf{appropriate release process} before deploying to
  production.
\end{itemize}

\hypertarget{appendix-solvency-ii-internal-model-approval-process-data-review-findings}{%
\section{Appendix: Solvency II: internal model approval process data review findings}\label{appendix-solvency-ii-internal-model-approval-process-data-review-findings}}

\hypertarget{sub-risk-5-it-environment-technology-and-tools}{%
\subsection{Sub-risk 5: IT environment, technology and tools}\label{sub-risk-5-it-environment-technology-and-tools}}

\begin{quote}
Spreadsheets and other user-developed applications are a form of information technology,
and all information technology needs to be appropriately controlled.
\end{quote}

\textbf{Finding 9: end-user computing (EUC)}

4.36 Spreadsheets and other end-user applications (2012.4.39) remained common in capital
and balance sheet modelling. The PRA does not have a view on whether end-user computing
(EUC) is appropriate, as it is a form of IT, and all IT needs to be appropriately
controlled. Where EUC is material to the internal model data flow, the PRA will be looking
for appropriate controls for data quality such as reasonableness checks, input validations,
peer reviews, systems environment configuration, logical access management, ongoing change
controls (development, build , systems and user acceptance testing) and release management
(including implementation and operational testing), disaster recovery, and documentation.

4.37 Automation of spreadsheets reduces the risk of manual error (2012.4.42), but can
introduce different problems such as reduced oversight, inadequate transparency about the
extent of linking and the proliferation of nested spreadsheets and the attendant issue of
`broken links'.

4.38 The 2012 report did not engage comprehensively with cyber risk. This is likely to be
an area of increasing focus, following alerts and increasing concerns about security as
firms move away from localised application and onto networked platforms. As noted in the
Bank of England Financial Stability Report,1 cyber attacks can threaten financial stability
by disrupting the provision of critical functions from the financial system to the real
economy. The Financial Policy Committee has recommended that resilience testing be a
regular part of core firms' cyber resilience assessment. Insurers providing cover for cyber
or business interruption are also indirectly exposed to cyber risk.

\textbf{Finding 10: IT infrastructure}

4.39 Complex IT implementations (2012.4.44) can be challenging to manage without a clear
definition of user requirements, design, testing and appropriate controls for effective
operation in business as usual. This continued to be an area of risk. One firm took seven
years to implement a tactical system, and still has no strategic system for its upstream
administration processes.

\hypertarget{software}{%
\chapter{Software}\label{software}}

When developing R code which may be shared or executed by another person it is important to
ensure everyone is using the same versions of software and packages. Differences in packages
can produced unexpected results and all versions of packages are not compatible with all versions
of R.

\hypertarget{core-r-applications}{%
\section{Core R Applications}\label{core-r-applications}}

The minimum software required to write R code is the R application itself. However, it is
better to use a separate editor for creating R scripts. The recommended software installation
is:

\begin{itemize}
\tightlist
\item
  \href{https://cloud.r-project.org/}{R}: Use the latest version whenever possible. If older versions
  are required they can be installed side-by-side. Within RStudio, the version of R to use can be
  selected in the Global Options. R can be used for Free.
\item
  \href{https://www.rstudio.com/products/rstudio/download/}{RStudio Desktop}: To edit R scripts
  and manage projects. As with R use the latest version possible. RStudio can also be used for
  free.
\item
  \href{https://cran.r-project.org/bin/windows/Rtools/}{RTools}: A set of tools required to build R
  packages. You must make sure you have the version compatible with the most recent version of R
  installed. RTools can also be used for free.
\end{itemize}

RStudio provides a cheatsheet detailing commonly used functionality of its editor:

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{images/rstudio-ide} 

}

\caption{RStudio Cheat Sheet}\label{fig:rstudio-cheatsheet}
\end{figure}

\hypertarget{supporting-software}{%
\section{Supporting Software}\label{supporting-software}}

In addition to the above, when writing R code of medium (or high) complexity or criticality it is
recommended that version control is used:

\begin{itemize}
\tightlist
\item
  \href{http://gitforwindows.org/}{Git} is the market leader version control software and integrates
  well with RStudio. Git is free.
\item
  \href{https://www.gitkraken.com/}{GitKraken} provides a very good graphical interface to
  Git and access to more features than RStudio. If you are working on complex projects with other
  team members then consider using GitKraken. GitKraken is not free, but it does not cost very
  much.
\item
  \href{https://help.github.com/}{GitHub} is a hosting platform for Git repositories. It also allows
  you to control access, formalise code reviews and plan projects.
\end{itemize}

\hypertarget{package-versions}{%
\section{Package Versions}\label{package-versions}}

A common problem with R is ensuring everyone is using the same version of packages. The
are a number of ways to deal with this problem:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  The simplest approach is to create a site library, a location on a network drive where
  everyone has access to. The default library location can then be set to this location so
  everyone uses the same packages.

  The disadvantage of this approach is that if someone updates a packages it is updated
  for everyone.
\item
  Another option, which can be used with the first option, is to point everyone's R installation
  to a snapshot of CRAN. This ensures that everyone installs packages released at a specified
  date. This can be achieved using either:

  \begin{itemize}
  \item
    Microsoft's \href{https://mran.microsoft.com/timemachine}{Time Machine} allows you select the
    version of CRAN to used based on a date.
  \item
    RStudio's \href{https://www.rstudio.com/products/package-manager/}{Package Manager} allows you to
    select a version of CRAN based on an ID. RStudio Package Manager is installed on premise and
    also allows the company to control the packages that can be installed.
  \end{itemize}
\item
  The most flexible approach is to use \href{development.html\#packrat}{packrat} when developing
  projects or packages. Packrat allows you to specify which versions of dependent packages you
  use for the project, and ensures that everyone using it also uses the same versions of
  the packages.
\end{enumerate}

\hypertarget{writing}{%
\chapter{Writing R Code}\label{writing}}

\hypertarget{writing-style}{%
\section{Writing Style}\label{writing-style}}

When writing code it is important to follow a common style so it is readable and
other people, and your future self, can easily understand and extend it.

\hypertarget{tidyverse}{%
\subsection{Tidyverse}\label{tidyverse}}

It is recommended, when using R, that we use the ``\href{https://www.tidyverse.org/}{Tidyverse}''
approach and packages wherever possible. The Tidyverse is a collection of packages designed
for data science, as well as a philosophy and style for formatting data and writing functions.
The \href{https://www.tidyverse.org/}{tidyverse.org} website details the packages involved and
contains articles on how to use them. Some of it will be summarised below, but the website
contains the definitive information.

The most in-depth treatment on the Tidyverse can be found in the book \emph{R for Data Science},
which is available online for free at \href{http://r4ds.had.co.nz/}{r4ds.had.co.nz}.

The tidyverse has an extensive \href{http://style.tidyverse.org/}{style guide}, which we
summarise here:

\hypertarget{files}{%
\subsection{Files}\label{files}}

\begin{itemize}
\tightlist
\item
  File names should be meaningful and end in \texttt{.R}, or \texttt{.Rmd} for R markdown files. Only
  use letters, numbers and \texttt{-} or \texttt{\_}.
\item
  If your script required packages load them all at once at the very beginning of the
  file.
\item
  Use comments to explain the ``why'' not the ``what'' or ``how''.
\item
  Break up files into named sections using commented lines (\texttt{\#\ -\/-\/-\/-}, example below). In
  RStudio you can collapse and expand sections commented this way.
\end{itemize}

\begin{verbatim}
# Load data --------------------------------------------------------------------
\end{verbatim}

\hypertarget{syntax}{%
\subsection{Syntax}\label{syntax}}

\begin{itemize}
\tightlist
\item
  Variable and function names should use only lowercase letters, numbers, and \texttt{\_}.
\item
  Always indent the code inside curly braces \texttt{\{\}} by two spaces.
\end{itemize}

\hypertarget{functions}{%
\subsection{Functions}\label{functions}}

\begin{itemize}
\tightlist
\item
  Use verbs for function names where possible.
\item
  If a function has numerous arguments put each one on a new line.
\item
  A function should do one thing well. If it is doing too much the break it up.
\item
  A function should be easily understandable in isolation. It should not refer
  to any variables outside the function scope.
\end{itemize}

\hypertarget{pipes}{%
\subsection{Pipes}\label{pipes}}

\begin{itemize}
\tightlist
\item
  Use \texttt{\%\textgreater{}\%} when you find yourself composing three or more functions together,
  instead of a nested call.
\item
  \texttt{\%\textgreater{}\%} should always have a space before it and a new line after it. After the
  first step, each line should be indented by two spaces.
\end{itemize}

\hypertarget{documentation-1}{%
\subsection{Documentation}\label{documentation-1}}

\begin{itemize}
\tightlist
\item
  Created functions should be documentated so others, including the future you,
  can understand what the function does and how to use it.
\item
  Documentation should be written before the function definition in an
  \href{https://cran.r-project.org/web/packages/roxygen2/vignettes/markdown.html}{roxygen2}
  style. roxygen uses special comments, starting with \texttt{\#\textquotesingle{}}. The first line is the
  title, and anything else, not prefixed with a keyword forms the description.
  Keywords start with \texttt{@} and the most important ones are \texttt{@param} to describe
  a function parameter and \texttt{@return} to describe what the function returns.
\end{itemize}

Here is a very simple example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' The length of a string.}
\CommentTok{#'}
\CommentTok{#' This function returns the number of characters in the supplied string.}
\CommentTok{#' }
\CommentTok{#' @param string input character vector}
\CommentTok{#'}
\CommentTok{#' @return integer vector giving number of characters in each element of the}
\CommentTok{#'   character vector.}
\CommentTok{#'}
\CommentTok{#' @export}
\CommentTok{#'}
\NormalTok{str_length <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(string) \{}
  \KeywordTok{nchar}\NormalTok{(string)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{structure}{%
\section{Structure}\label{structure}}

Organising files for a particular piece of work becomes more important as the scale and
complexity increases. Standard approaches exists to simplify the workflow.

\hypertarget{projects}{%
\subsection{Projects}\label{projects}}

Use RStudio projects to organise files. This has a number of advantages:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Sets the working directory to the project location
\item
  Reopens the same files when returning to the projects
\item
  Saves the workspace so data and code is loaded when you re-open the project
\end{enumerate}

\hypertarget{folders}{%
\subsection{Folders}\label{folders}}

When an analysis becomes complex it should be split up into logical parts and stored in
subfolders. Store the original data in a folder, unchanged. It is better to ``cleanse'' input
data with an R script as it can repeated when data changes, and/or the approach changed
itself.

R code may also be stored in a separate folder. You may have an R script for cleansing the
data and another for performing an analysis. Include an R script at the top level which
executes the code in the subfolder in the appropriate order. Use relative paths to the
files. If an RStudio project has been created the working directory will be set to the
project directory automatically.

Output the results, plots, data, etc, in another folder so it is clear whether data files
are results rather than inputs.

An example of a project structure:

\begin{itemize}
\tightlist
\item
  data

  \begin{itemize}
  \tightlist
  \item
    interesting-data.xlsx
  \item
    reference-data.csv
  \end{itemize}
\item
  R

  \begin{itemize}
  \tightlist
  \item
    clean-data.R
  \item
    analyse.R
  \end{itemize}
\item
  tests

  \begin{itemize}
  \tightlist
  \item
    test-cleansed-data.R
  \item
    test-analysis.R
  \end{itemize}
\item
  results

  \begin{itemize}
  \tightlist
  \item
    cool-plot.png
  \item
    table-of-results.csv
  \end{itemize}
\item
  run-code.R
\item
  README.md
\end{itemize}

\hypertarget{readme}{%
\subsection{README}\label{readme}}

Adding a README file is a good way to explain to other, and you future self, what the analysis
does and how to use it. The \href{index.html\#documentation}{documentation} section of the best
practice has more detail on what should be included.

It is recommended that \href{http://rmarkdown.rstudio.com/lesson-8.html}{markdown} is used to
write the README. It is a very simple way to specify text formatting in a plain text file
and can be converted to many other formats (HTML, docx, PDF) if required. In addition, if
the package is stored in GitHub a markdown README is automatically rendered on the
repository's page.

\hypertarget{r-packages}{%
\subsection{R Packages}\label{r-packages}}

When R code has high criticality consider turning it into a package. A package is a way
of collecting together related code in a robust way. It has the following advantages:

\begin{itemize}
\tightlist
\item
  Easier to share with others (as a zip file)
\item
  Documentation is compiled into help pages
\item
  All tests can be executed with a single command
\item
  Can implement a development and release process
\item
  Code is broken up into useful functions
\end{itemize}

Writing a package is very straight forward with the helper packages available today. More
information can be found in \href{development.html\#packages}{Package Development}.

\hypertarget{r-markdown}{%
\section{R Markdown}\label{r-markdown}}

\href{http://rmarkdown.rstudio.com/}{R markdown} is a way of capturing documentation, code and
results and in a single file. The document is written in plain text using a style called
\href{https://rmarkdown.rstudio.com/authoring_basics.html}{markdown}. This has a simple syntax
for specifying text formatting. R code is added in ``chunks'' and when the document is
rendered the R code is executed and replaced with the results.

R markdown can be used to produce web pages, Word and PDF documents. The provide a
robust way of capturing an analysis and the results and can be re-run when the data
changes.

RStudio provides a cheatsheet detailing R markdown functionality:

\href{https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf}{\includegraphics{images/rmarkdown.png}}

For a detailed guide the book \href{https://bookdown.org/yihui/rmarkdown/}{R Markdown} is available for
free online.

\hypertarget{markdown}{%
\subsection{Markdown}\label{markdown}}

Markdown is a lightweight markup language with plain text formatting syntax. It is
designed so that it can be converted to HTML and many other formats.

\hypertarget{paragraphs}{%
\subsubsection{Paragraphs}\label{paragraphs}}

Leave at least one empty line between text to start a new paragraph.

\begin{verbatim}
This is the first paragraph.

This is the second paragraph.
\end{verbatim}

This is the first paragraph.

This is the second paragraph.

\hypertarget{headers}{%
\subsubsection{Headers}\label{headers}}

\begin{verbatim}
# Header 1

## Header 2

### Header 3
\end{verbatim}

\hypertarget{emphasis}{%
\subsubsection{Emphasis}\label{emphasis}}

\begin{verbatim}
*italic*   **bold**

_italic_   __bold__
\end{verbatim}

\emph{italic} \textbf{bold}

\emph{italic} \textbf{bold}

\hypertarget{lists}{%
\subsubsection{Lists}\label{lists}}

Unordered List:

\begin{verbatim}
* Item 1
* Item 2
    + Item 2a
    + Item 2b
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Item 1
\item
  Item 2

  \begin{itemize}
  \tightlist
  \item
    Item 2a
  \item
    Item 2b
  \end{itemize}
\end{itemize}

Ordered List:

\begin{verbatim}
1. Item 1
2. Item 2
3. Item 3
    a. Item 3a
    b. Item 3b
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Item 1
\item
  Item 2
\item
  Item 3

  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
    Item 3a
  \item
    Item 3b
  \end{enumerate}
\end{enumerate}

\hypertarget{links}{%
\subsubsection{Links}\label{links}}

Use a plain http address or add a link to a phrase:

\begin{verbatim}
http://example.com

[linked phrase](http://example.com)
\end{verbatim}

\url{http://example.com}

\href{http://example.com}{linked phrase}

\hypertarget{images}{%
\subsubsection{Images}\label{images}}

Images on the web or local files in the same directory:

\begin{verbatim}
![](https://upload.wikimedia.org/wikipedia/commons/1/1b/R_logo.svg)

![optional caption text](images/octocat.png)
\end{verbatim}

\includegraphics{images/R_logo.png}

\begin{figure}
\centering
\includegraphics{images/octocat.png}
\caption{optional caption text}
\end{figure}

\hypertarget{reference-style-links-and-images}{%
\subsubsection{Reference Style Links and Images}\label{reference-style-links-and-images}}

Links

\begin{verbatim}
A [linked phrase][id].

At the bottom of the document:

[id]: http://example.com/ "Title"
\end{verbatim}

A \href{images/octocat.png}{linked phrase}.

At the bottom of the document:

Images

\begin{verbatim}
![alt text][id]

At the bottom of the document:

[id]: images/octocat.png "Octocat"
\end{verbatim}

\begin{figure}
\centering
\includegraphics{images/octocat.png}
\caption{alt text}
\end{figure}

At the bottom of the document:

\hypertarget{blockquotes}{%
\subsubsection{Blockquotes}\label{blockquotes}}

\begin{verbatim}
A friend once said:

> It's always better to give
> than to receive.
\end{verbatim}

A friend once said:

\begin{quote}
It's always better to give
than to receive.
\end{quote}

\hypertarget{plain-code-blocks}{%
\subsubsection{Plain Code Blocks}\label{plain-code-blocks}}

Plain code blocks are displayed in a fixed-width font but not evaulated

\begin{verbatim}
```
This text is displayed verbatim / preformatted
```
\end{verbatim}

\begin{verbatim}
This text is displayed verbatim / preformatted
\end{verbatim}

\hypertarget{inline-code}{%
\subsubsection{Inline Code}\label{inline-code}}

\begin{verbatim}
We defined the `add` function to compute the sum of two numbers.
\end{verbatim}

We defined the \texttt{add} function to compute the sum of two numbers.

\hypertarget{latex-equations}{%
\subsubsection{LaTeX Equations}\label{latex-equations}}

Inline equation:

\begin{verbatim}
Einstein's famous equation $E = mc^2$
\end{verbatim}

Einstein's famous equation \(E = mc^2\)

Display equation:

\begin{verbatim}
$$
E = mc^2
$$
\end{verbatim}

\[
E = mc^2
\]

\hypertarget{horizontal-rule-page-break}{%
\subsubsection{Horizontal Rule / Page Break}\label{horizontal-rule-page-break}}

Three or more asterisks or dashes:

\begin{verbatim}
******

------
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\hypertarget{tables}{%
\subsubsection{Tables}\label{tables}}

\begin{verbatim}
First Header  | Second Header
------------- | -------------
Content Cell  | Content Cell
Content Cell  | Content Cell
\end{verbatim}

\begin{longtable}[]{@{}ll@{}}
\toprule
First Header & Second Header\tabularnewline
\midrule
\endhead
Content Cell & Content Cell\tabularnewline
Content Cell & Content Cell\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{manual-line-breaks}{%
\subsubsection{Manual Line Breaks}\label{manual-line-breaks}}

End a line with a backslash:

\begin{verbatim}
Roses are red,\
Violets are blue.
\end{verbatim}

Roses are red,\\
Violets are blue.

\hypertarget{miscellaneous}{%
\subsubsection{Miscellaneous}\label{miscellaneous}}

\begin{verbatim}
superscript^2^

~~strikethrough~~
\end{verbatim}

superscript\textsuperscript{2}

\sout{strikethrough}

\hypertarget{r-code-chunks}{%
\subsection{R Code Chunks}\label{r-code-chunks}}

R code surrounded with three ticks and designated \texttt{\{R\}} (see below) will be evaluated and printed.

```

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(cars}\OperatorTok{$}\NormalTok{dist)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    2.00   26.00   36.00   42.98   56.00  120.00
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(cars}\OperatorTok{$}\NormalTok{speed)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     4.0    12.0    15.0    15.4    19.0    25.0
\end{verbatim}

```

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(cars}\OperatorTok{$}\NormalTok{dist)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    2.00   26.00   36.00   42.98   56.00  120.00
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(cars}\OperatorTok{$}\NormalTok{speed)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     4.0    12.0    15.0    15.4    19.0    25.0
\end{verbatim}

Inline R Code:

\begin{verbatim}
There were 50 cars studied
\end{verbatim}

There were 50 cars studied

There are many options available when executing R code chunks. For more information read the
\href{https://bookdown.org/yihui/rmarkdown/r-code.html}{R code chunks} chapter in the R Markdown book.

\hypertarget{r-notebooks}{%
\subsection{R Notebooks}\label{r-notebooks}}

An R Notebook is an R Markdown document with chunks that can be executed independently and
interactively, with output visible immediately beneath the input. They direct interaction with
R while producing a reproducible document with publication-quality output.

Any R Markdown document can be used as a notebook, and all R Notebooks can be rendered to other R
Markdown document types. A notebook can therefore be thought of as a special execution mode for R
Markdown documents. The immediacy of notebook mode makes it a good choice while authoring the R
Markdown document and iterating on code. When you are ready to publish the document, you can share
the notebook directly, or render it to a publication format with the Knit button.

\hypertarget{creating-a-notebook}{%
\subsubsection{Creating a Notebook}\label{creating-a-notebook}}

You can create a new notebook in RStudio with the menu command \texttt{File\ -\textgreater{}\ New\ File\ -\textgreater{}\ R\ Notebook},
or by using the \texttt{html\_notebook} output type in your document's YAML metadata.

\begin{verbatim}
---
title: "My Notebook"
output: html_notebook
---
\end{verbatim}

\hypertarget{inserting-chunks}{%
\subsubsection{Inserting chunks}\label{inserting-chunks}}

Notebook chunks can be inserted quickly using the keyboard shortcut \texttt{Ctrl\ +\ Alt\ +\ I}, or via the
\texttt{Insert} menu in the editor toolbar.

Because all of a chunk's output appears beneath the chunk (not alongside the statement which
emitted the output, as it does in the rendered R Markdown output), it is often helpful to split
chunks that produce multiple outputs into two or more chunks which each produce only one output.

\hypertarget{executing-chunks}{%
\subsection{Executing chunks}\label{executing-chunks}}

To execute a chunk of code use the green triangle button on the toolbar of a code chunk that has
the tooltip ``Run Current Chunk'', or \texttt{Ctrl\ +\ Shift\ +\ Enter} to run the current chunk. The result is
then displayed underneath the chunk.

\hypertarget{saving-and-sharing}{%
\subsection{Saving and sharing}\label{saving-and-sharing}}

When a notebook \texttt{*.Rmd} file is saved, a \texttt{*.nb.html} file is created alongside it. This file is a
self-contained HTML file which contains both a rendered copy of the notebook with all current chunk
outputs (suitable for display on a website) and a copy of the \texttt{*.Rmd} file itself.

You can view the \texttt{*.nb.html} file in any ordinary web browser. It can also be opened in RStudio;
when you open there (e.g., using \texttt{File\ -\textgreater{}\ Open\ File}), RStudio will do the following:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Extract the bundled \texttt{*.Rmd} file, and place it alongside the \texttt{*.nb.html} file.
\item
  Open the \texttt{*.Rmd} file in a new RStudio editor tab.
\item
  Extract the chunk outputs from the \texttt{*.nb.html} file, and place them appropriately in the editor.
\end{enumerate}

\hypertarget{more-information}{%
\subsubsection{More information}\label{more-information}}

For more a more detailed guide on R Notebooks read the
\href{https://bookdown.org/yihui/rmarkdown/notebook.html}{Notebook chapter} in the R Markdown book.

\hypertarget{packages}{%
\chapter{Recommended Packages}\label{packages}}

\hypertarget{data-wrangling}{%
\section{Data Wrangling}\label{data-wrangling}}

\begin{quote}
Data wrangling is the process of transforming and mapping data from one ``raw'' data form
into another format with the intent of making it more appropriate and valuable for a
variety of downstream purposes such as analytics.

-- \href{https://en.wikipedia.org/wiki/Data_wrangling}{\emph{Wikipedia}}
\end{quote}

\hypertarget{tidy-data}{%
\subsection{Tidy Data}\label{tidy-data}}

The Tidyverse of packages are built around the concept of tidy data, first introduced by
Jeff Leek in his book \emph{The Elements of Data Analytic Style}. Hadley Wickham summarises the
characteristics of \href{http://tidyr.tidyverse.org/articles/tidy-data.html}{tidy data} with
the following points:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Each variable forms a column.
\item
  Each observation forms a row.
\item
  Each type of observational unit forms a table.
\end{enumerate}

\hypertarget{importing-data}{%
\subsection{Importing Data}\label{importing-data}}

The first step in wrangling is importing the data into R. The methods to do so depend on the
source of data:

\begin{itemize}
\tightlist
\item
  Reading files
\item
  Connecting to databases
\item
  Web APIs or pages
\end{itemize}

\hypertarget{reading-files}{%
\subsubsection{Reading Files}\label{reading-files}}

Files may come in many formats and R has packages to read many of them. The most common
for data science are tabular text files, such as CSVs, and Excel spreadsheets. The
recommended packages for reading these files are:.

\begin{itemize}
\tightlist
\item
  \href{http://readr.tidyverse.org/}{\texttt{readr}} for reading text files
\item
  \href{http://readxl.tidyverse.org/}{\texttt{readxl}} for reading Excel files
\item
  \href{https://www.rdocumentation.org/packages/openxlsx/}{\texttt{openxlsx}} for writing to Excel
  files
\end{itemize}

For more detail, read the \href{https://r4ds.had.co.nz/data-import.html}{Data Import} chapter in
the \emph{R for Data Science} book or use the cheatsheet below for reference.

\href{https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf}{\includegraphics{images/data-import.png}}

\hypertarget{tibbles}{%
\subsubsection{Tibbles}\label{tibbles}}

When using the Tidyverse packages you may notice they return a \texttt{tibble} rather than a
\texttt{data.frame} They are basically the same thing except construction and subsetting are more
consistent. They also display nicely when printed to the console. The package
\href{http://tibble.tidyverse.org/}{\texttt{tibble}} has some useful functions for constructing tibbles.

For more detail, read the \href{https://r4ds.had.co.nz/tibbles.html}{Tibbles} chapter in the
\emph{R for Data Science} book or use the \emph{Data Import} cheatsheet above for reference.

\hypertarget{connecting-to-databases}{%
\subsubsection{Connecting to Databases}\label{connecting-to-databases}}

The \href{https://db.rstudio.com/rstudio/connections/}{RStudio Connections Pane} makes it possible
to easily connect to a variety of data sources, and explore the objects and data inside the
connection.

The recommended packages for connecting to databases (also used by RStudio) are:

\begin{itemize}
\tightlist
\item
  \href{https://db.rstudio.com/DBI}{\texttt{DBI}} provides a standard interface to any database
\item
  \href{https://db.rstudio.com/odbc/}{\texttt{odbc}} for connecting to databases using ODBC
\item
  \href{https://db.rstudio.com/dplyr/}{\texttt{dplyr}} for transforming tables in a database
\end{itemize}

For more detail, read the \href{https://db.rstudio.com/}{Databases using R} website by RStudio.

\hypertarget{web-apis-and-pages}{%
\subsubsection{Web APIs and Pages}\label{web-apis-and-pages}}

Obtaining data from the internet has two main approaches. If the website provides an
application programming interface (API) then you can send and receive data through it.
The data from web APIs is usually returned in JSON or XML format. Alternatively, you can
scrape the website itself, extracting data from the pages. The recommended packages for
these approaches are:

\begin{itemize}
\tightlist
\item
  \href{http://httr.r-lib.org/}{\texttt{httr}} for communicating with web APIs
\item
  \href{https://www.rdocumentation.org/packages/jsonlite}{\texttt{jsonlite}} for reading JSON
  formatted text
\item
  \href{https://www.rdocumentation.org/packages/xml2}{\texttt{xml2}} for reading XML formatted text
\item
  \href{https://www.rdocumentation.org/packages/rvest}{\texttt{rvest}} for scraping
  web pages
\end{itemize}

\hypertarget{transforming-data}{%
\subsection{Transforming Data}\label{transforming-data}}

Now you have the data you want, it probably requires some processing in order to get it
into a structure that is useful for analysis. There are two main packages for this
\href{http://tidyr.tidyverse.org}{\texttt{tidyr}} and \href{http://dplyr.tidyverse.org}{\texttt{dplyr}}

\hypertarget{tidying-data}{%
\subsubsection{Tidying Data}\label{tidying-data}}

The focus of \href{http://tidyr.tidyverse.org}{\texttt{tidyr}} is to get the data into a tidy format.
It provides functions for reshaping the data, as well as dealing with implicit and explicit
missing values.

For more detail, read the \href{https://r4ds.had.co.nz/tidy-data.html}{Tidy Data} chapter in
the \emph{R for Data Science} book or use the \emph{Data Import} cheatsheet above for reference.

\hypertarget{manipulating-data}{%
\subsubsection{Manipulating Data}\label{manipulating-data}}

\href{http://dplyr.tidyverse.org}{\texttt{dplyr}} is a grammar of data manipulation, providing a
consistent set of verbs that help you solve the most common data manipulation challenges. For
example; Calculating a new variable (or column) based on existing ones, selecting columns,
filtering tables and summarising them by groups. \href{http://dplyr.tidyverse.org}{\texttt{dplyr}} also
provides a set of functions for combining tables.

For more detail, read the \href{https://r4ds.had.co.nz/transform.html}{Data Transformation} chapter in
the \emph{R for Data Science} book or use the cheatsheet below for reference.

\href{https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf}{\includegraphics{images/data-transformation.png}}

\hypertarget{variable-types}{%
\subsubsection{Variable Types}\label{variable-types}}

There are also packages which simplify working with specific types of data:

\begin{itemize}
\tightlist
\item
  \href{http://stringr.tidyverse.org/}{\texttt{stringr}} for strings and regular expressions
\item
  \href{http://forcats.tidyverse.org/}{\texttt{forcats}} for factors, used to handle categorical data
\item
  \href{http://lubridate.tidyverse.org/}{\texttt{lubridate}} for dates and date-times.
\item
  \href{https://www.rdocumentation.org/packages/hms}{\texttt{hms}} for time-of-day values.
\end{itemize}

For more detail, read the \href{https://r4ds.had.co.nz/strings.html}{Strings},
\href{https://r4ds.had.co.nz/factors.html}{Factors}, or
\href{https://r4ds.had.co.nz/dates-and-times.html}{Dates and Times} chapters in the
\emph{R for Data Science} book or use the cheatsheets below for reference.

\href{https://github.com/rstudio/cheatsheets/raw/master/strings.pdf}{\includegraphics{images/stringr.png}}
\href{https://github.com/rstudio/cheatsheets/raw/master/lubridate.pdf}{\includegraphics{images/lubridate.png}}

\hypertarget{visualising-data}{%
\section{Visualising Data}\label{visualising-data}}

When it comes to visualising data the most commonly used package is
\href{https://ggplot2.tidyverse.org/}{\texttt{ggplot2}}. \href{https://ggplot2.tidyverse.org/}{\texttt{ggplot2}}
only produces static plots, which is great if you want to insert it into a report, but if you want
to create interactive graphs in a web page use the \href{https://plot.ly/r/}{\texttt{plotly}} package.

\hypertarget{grammer-of-graphics}{%
\subsection{Grammer of Graphics}\label{grammer-of-graphics}}

The \href{https://ggplot2.tidyverse.org/}{\texttt{ggplot2}} package is based on the grammer of graphics which
allows you to create plots by adding layers of geometric objects, e.g.~point, lines, etc, with
aesthetics mapped to variables, e.g.~coordinates, size, etc. This framework allows for highly
customisable plots.

For more detail, read the \href{https://r4ds.had.co.nz/data-visualisation.html}{Data Visualisation}
chapter in the \emph{R for Data Science} book or use the cheatsheet below for reference.

\href{https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf}{\includegraphics{images/ggplot2.png}}

\hypertarget{interactive-graphics}{%
\subsection{Interactive Graphics}\label{interactive-graphics}}

If you want to add a plot to a web page then you'll probably want something more interactive.
\href{https://plot.ly/r/}{\texttt{plotly}} produces high-quality graphics with the ability to zoom, pan and
add tool-tips, etc.

For more detail, read the \href{https://plotly-book.cpsievert.me/}{Plotly for R} book or use the
cheatsheet below for reference.

\href{https://images.plot.ly/plotly-documentation/images/r_cheat_sheet.pdf}{\includegraphics{images/plotly.png}}

\hypertarget{development}{%
\chapter{Development Practices}\label{development}}

\hypertarget{package-development}{%
\section{Package Development}\label{package-development}}

If you have functions or code that is used across projects then the best practice is to build a
package. A package combines a set of related functionality which can then be shared easily
between projects and other users. The package \href{http://devtools.r-lib.org/}{\texttt{devtools}} makes
package development straight forward. For more detailed information about creating packages, read
the \href{http://r-pkgs.had.co.nz/}{R Packages} book or use the cheatsheet below for reference.

\href{https://rawgit.com/rstudio/cheatsheets/master/package-development.pdf}{\includegraphics{images/package-development.png}}

NOTE: \href{http://devtools.r-lib.org/}{\texttt{devtools}} is currently being split up into smaller packages
and the above book and cheatsheet are slightly out of date.

Package development has a formal structure, which addresses many of the areas detailed in the
End-User Computing standards. The package \href{https://usethis.r-lib.org}{\texttt{usethis}} provides
functions to ease the setup of the package structure. To set up an empty package use:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{create_package}\NormalTok{(}\StringTok{"pkgname"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Functions you wish to add to the package are saved in scripts in the \texttt{R} subfolder that has been
created.

\hypertarget{documentation-2}{%
\subsection{Documentation}\label{documentation-2}}

Documentation comes in three flavours in an R package. The DESCRIPTION file details the package
itself including author and dependencies; help files contains documentation for each function in
the package; and vignettes are small articles describing how to use the functions in practice.

\hypertarget{description}{%
\subsubsection{DESCRIPTION}\label{description}}

The function \texttt{usethis::create\_package()} creates the basic structure of the package and a
placeholder DESCRIPTION file. You can then edit it manually or use other functions in the
\href{https://usethis.r-lib.org}{\texttt{usethis}} package to update it.

For more detail, read the \href{http://r-pkgs.had.co.nz/description.html}{Package metadata} chapter in
the \emph{R Packages} book.

\hypertarget{help-files}{%
\subsubsection{Help Files}\label{help-files}}

When writing a function in a package it is good practice to document it, so a user can see how it
works with \texttt{help("function\_name")}. Documenting a package is as straight forward as including a
special commented section before the function definition. The package
\href{https://www.rdocumentation.org/packages/roxygen2}{\texttt{roxygen2}} is then used to convert those
comments into help files.

For more detail, read the \href{http://r-pkgs.had.co.nz/man.html}{Object documentation} chapter in
the \emph{R Packages} book.

\hypertarget{vignettes}{%
\subsubsection{Vignettes}\label{vignettes}}

When writing a package, it is also good practice to write a short article explaining how to use
it. If the package is complex it may require a number articles describing different aspects. These
short articles are called vignettes. Vignettes are written in markdown format and stored in a
\texttt{vignettes} subfolder.

For more detail, read the \href{http://r-pkgs.had.co.nz/vignettes.html}{Vignettes} chapter in
the \emph{R Packages} book.

\hypertarget{testing-1}{%
\subsection{Testing}\label{testing-1}}

R packages provide a structure for specifying tests that allows you easily re-run all tests and
determine whether something has broken. The package \href{http://testthat.r-lib.org/}{\texttt{testthat}}
provides functions for specifying tests and comparing the results with expectations.

For more detail, read the \href{http://r-pkgs.had.co.nz/tests.html}{Testing} chapter in
the \emph{R Packages} book.

\hypertarget{version-control}{%
\section{Version Control}\label{version-control}}

\hypertarget{git}{%
\subsection{Git}\label{git}}

\hypertarget{github-flow}{%
\subsection{GitHub Flow}\label{github-flow}}

\hypertarget{managing-package-dependencies}{%
\section{Managing Package Dependencies}\label{managing-package-dependencies}}

\hypertarget{advanced}{%
\chapter{Advanced Topics}\label{advanced}}

\hypertarget{non-standard-evaluation}{%
\section{Non-Standard Evaluation}\label{non-standard-evaluation}}

Non-standard evaluation is a catch-all term that means they don't follow the usual R rules
of evaluation. Instead, they capture the expression that you typed and evaluate it in a
custom way.

\hypertarget{strings-and-quoting}{%
\subsection{Strings and quoting}\label{strings-and-quoting}}

Here's a simple example in the case of strings. If you want to return a personalised
message, it is obvious the below function will not give you what you want:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{greet <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(name) \{}
  \StringTok{"Hello, name"}
\NormalTok{\}}

\KeywordTok{greet}\NormalTok{(}\StringTok{"Bob"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Hello, name"
\end{verbatim}

The function returns the string exactly as it is written because it is in quotes. With the
\href{https://www.rdocumentation.org/packages/glue}{\texttt{glue}} package you can use non-standard
evaluation to return what you want:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{greet <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(name) \{}
  \KeywordTok{glue}\NormalTok{(}\StringTok{"Hello, \{name\}"}\NormalTok{)}
\NormalTok{\}}

\KeywordTok{greet}\NormalTok{(}\StringTok{"Bob"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Hello, Bob
\end{verbatim}

The \href{https://www.rdocumentation.org/packages/glue/topics/glue}{\texttt{glue()}} function
``unquotes'' the ``name'' and evaluates it as a variable.

\hypertarget{base-r-evaluation}{%
\subsection{Base R evaluation}\label{base-r-evaluation}}

\hypertarget{expressions-and-quoting}{%
\subsubsection{Expressions and quoting}\label{expressions-and-quoting}}

A similar approach can be taken to more general expressions in R. An \textbf{expression} is some
R code has not been evaluated yet. It is captured and saved for later. In base R this can
be achieved using the
\href{https://www.rdocumentation.org/packages/base/topics/substitute}{\texttt{quote()}} function.
Expressions can be one of four classes:

\begin{itemize}
\tightlist
\item
  ``constants'' (e.g.~4, TRUE).
\item
  ``names'' (e.g.~variable names), that have type ``symbols''.
\item
  ``calls'' (e.g.~unevaluated function calls), that have type ``language''.
\item
  ``pairlists'' (not really used anymore).
\end{itemize}

Constants are not very interesting, so we will concentrate on names and calls. As with
strings, we can capture the expression, rather than the evaluated result, using the
\href{https://www.rdocumentation.org/packages/base/topics/substitute}{\texttt{quote()}} function:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quote}\NormalTok{(x) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{class}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "name"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quote}\NormalTok{(}\KeywordTok{mean}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{class}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "call"
\end{verbatim}

To evaluate a quoted expression use the
\href{https://www.rdocumentation.org/packages/base/topics/eval}{\texttt{eval()}} function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{10}

\KeywordTok{quote}\NormalTok{(x) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{eval}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quote}\NormalTok{(}\KeywordTok{mean}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{eval}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5.5
\end{verbatim}

\hypertarget{names-and-environments}{%
\subsubsection{Names and Environments}\label{names-and-environments}}

An \textbf{environment} is a container for variables, binding a set of names to a set of values.
Every environment also has a parent environment, except the \textbf{empty} environment, which is
the ultimate ancester of all environments. If a name is not found in the current environment
R looks in its parent and so on through the generations. This is known as \textbf{lexical
scoping}.

When using \texttt{eval()} as above the expression is evaluated in the current environment.
However, the environment to evaluate the expression in can be set as a parameter to
\texttt{eval()}.

Note: \texttt{data.frames} can be treated as environments containing the column names binded to the
column vectors.

\hypertarget{calls}{%
\subsubsection{Calls}\label{calls}}

A \textbf{call} is a delayed evaluation of a function call. The function and the argument names
are stored, but not evaluated. So you can change the values associated with the arguments
before evaluation. In fact they need not be defined at creation time at all:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wait_for_it <-}\StringTok{ }\KeywordTok{quote}\NormalTok{(x }\OperatorTok{+}\StringTok{ }\NormalTok{y)}

\NormalTok{x <-}\StringTok{ }\DecValTok{3}
\NormalTok{y <-}\StringTok{ }\DecValTok{8}

\KeywordTok{eval}\NormalTok{(wait_for_it)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11
\end{verbatim}

\hypertarget{parsing-and-deparsing}{%
\subsubsection{Parsing and Deparsing}\label{parsing-and-deparsing}}

\textbf{Parsing} turns text into expressions and \textbf{deparsing} turns expressions into text.
The \href{https://www.rdocumentation.org/packages/base/topics/parse}{\texttt{parse()}} function
converts text, but its default argument is a file connection, so we must use the text
argument:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{parse}\NormalTok{(}\DataTypeTok{text =} \StringTok{"8 + 10"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{eval}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 18
\end{verbatim}

Deparse might be useful for returning information to the user:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{friendly_eval <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(expr) \{}
  \KeywordTok{str_c}\NormalTok{(}\StringTok{"The value of "}\NormalTok{, }\KeywordTok{deparse}\NormalTok{(expr), }\StringTok{" is "}\NormalTok{, }\KeywordTok{eval}\NormalTok{(expr))}
\NormalTok{\}}

\KeywordTok{quote}\NormalTok{(}\DecValTok{8} \OperatorTok{+}\StringTok{ }\DecValTok{10}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{friendly_eval}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "The value of 8 + 10 is 18"
\end{verbatim}

\hypertarget{functions-and-closures}{%
\subsubsection{Functions and closures}\label{functions-and-closures}}

When you execute a function it creates a new, temporary, environment. The named arguments
to the function, plus any variables created within its body are stored in this environment.
Thus it cannot effect the variables outside its scope.

The parent for the function's environment is the environment in which the function was
created in, not the one in which it was executed in. Thus it has access to all the
variables in the parent environment. This is known as \textbf{closure}, as it \emph{encloses} the
parent environment, and can be a powerful tool.

\hypertarget{substitute-and-promise}{%
\subsubsection{Substitute and promise}\label{substitute-and-promise}}

The \texttt{friendly\_eval()} function above requires its argument to be quoted. It would be nice
if we could write the expression directly as an argument. However, \texttt{quote()} makes a
literal quote of its input, in this case \texttt{expr}. What we need is
\href{https://www.rdocumentation.org/packages/base/topics/substitute}{\texttt{substitute()}}. This will
lookup all the object names provided to it, and if it finds a value for that name, it will
substitute the name for its value:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{friendly_eval <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(expr) \{}
\NormalTok{  expr_sub <-}\StringTok{ }\KeywordTok{substitute}\NormalTok{(expr)}
  \KeywordTok{str_c}\NormalTok{(}\StringTok{"The value of "}\NormalTok{, }\KeywordTok{deparse}\NormalTok{(expr_sub), }\StringTok{" is "}\NormalTok{, }\KeywordTok{eval}\NormalTok{(expr_sub))}
\NormalTok{\}}

\KeywordTok{friendly_eval}\NormalTok{(}\DecValTok{8} \OperatorTok{+}\StringTok{ }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "The value of 8 + 10 is 18"
\end{verbatim}

The above function only works because in R function arguments are evaluated lazily --
variables are not evaluated until they are used. R stores arguments as a \textbf{promise},
which contains the expression of an argument along with the value. \texttt{substitute()}
capture the expression before it is evaluated.

\hypertarget{formula-and-overscoping}{%
\subsubsection{Formula and overscoping}\label{formula-and-overscoping}}

A \textbf{formula} is a \emph{domain specific language} (DSL) to simplify expressing the relationship
between variables. Just like functions, formulas enclose the environment they are created
in. When a formula is evaluated later in a different environment, it can still access all
the objects that lived in its original environment.

If an object exists in more than one accessible environment the enviroment the formula
(or function) is evaluated in takes precidence. If the object is not found, R looks
in the enclosed environment. This is known as \textbf{overscoping}, as the formula or
function has scope beyond its execution environment.

\hypertarget{tidy-evaluation}{%
\subsection{Tidy Evaluation}\label{tidy-evaluation}}

To summarise the above, the following points are important to tidy evaluation:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{quote()} delays evaluation of an expression.
\item
  \texttt{eval()} evaluates an expression in the current (or a specified) environment.
\end{enumerate}

Functions and formulas:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  enclose the environment they were created in.
\item
  evaluate objects in their own, and enclosed, environments
\end{enumerate}

Tidy evaluation has two new additions: \textbf{quasiquotation} and \textbf{quosures}.

\hypertarget{quasiquotation}{%
\subsubsection{Quasiquotation}\label{quasiquotation}}

\textbf{Quasiquotation} enables the user to evaluate parts of the expression right away, while
quoting the rest. Say we have the expression \texttt{z\ -\ x\ +\ 4} and we know the value of \texttt{x} at
the time of quoting, we can \textbf{unquote} \texttt{x} with the function
\href{http://rlang.tidyverse.org/reference/quasiquotation.html}{\texttt{UQ()}} or the operator
\href{http://rlang.tidyverse.org/reference/quasiquotation.html}{\texttt{!!}}. However, \texttt{quote()}
will not work in this quasiquotation, we need to use the tidy evaluation equivalent,
\href{http://rlang.tidyverse.org/reference/expr.html}{\texttt{expr()}}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{10}

\KeywordTok{expr}\NormalTok{(z }\OperatorTok{-}\StringTok{ }\KeywordTok{UQ}\NormalTok{(x) }\OperatorTok{+}\StringTok{ }\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## z - 10 + 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{expr}\NormalTok{(z }\OperatorTok{-}\StringTok{ }\OperatorTok{!!}\NormalTok{x }\OperatorTok{+}\StringTok{ }\DecValTok{4}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{class}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "call"
\end{verbatim}

The \texttt{expr()} function returns expressions, as does \texttt{quote()}, without any information on
the environment it was created in. Some other useful functions for quasiquotation are:

\begin{itemize}
\tightlist
\item
  \href{http://rlang.tidyverse.org/reference/quasiquotation.html}{\texttt{UQS()}} and the
  \href{http://rlang.tidyverse.org/reference/quasiquotation.html}{\texttt{!!!}} operator unquote and
  splice their arguments.
\item
  \href{http://rlang.tidyverse.org/reference/expr.html}{\texttt{enexpr()}} takes an expression, looks
  up any symbols (names) within it and returns it unevaluated. It is equivalent to
  \texttt{substitute()}.
\item
  \href{http://rlang.tidyverse.org/reference/expr.html}{\texttt{exprs()}} captures multiple
  expressions and returns a list.
\end{itemize}

\hypertarget{quosures}{%
\subsubsection{Quosures}\label{quosures}}

As the name suggests, \textbf{quosures} are hybrids of quotes and closures. They are
unevaluated expressions that enclose their creation environment. This is very similar to
formulas and they are in fact implemented as one-sided formulas. Quosures are created with
the \href{http://rlang.tidyverse.org/reference/quosure.html}{\texttt{quo()}} function:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quo}\NormalTok{(z }\OperatorTok{-}\StringTok{ }\KeywordTok{UQ}\NormalTok{(x) }\OperatorTok{+}\StringTok{ }\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## <quosure>
## expr: ^z - 10 + 4
## env:  global
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quo}\NormalTok{(z }\OperatorTok{-}\StringTok{ }\OperatorTok{!!}\NormalTok{x }\OperatorTok{+}\StringTok{ }\DecValTok{4}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{class}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "quosure" "formula"
\end{verbatim}

The quosure equivalent of \texttt{substitute()} is
\href{http://rlang.tidyverse.org/reference/quosure.html}{\texttt{enquo()}}. It takes a symbol referring
to a function argument, quotes the R code that was supplied to this argument, captures the
environment where the function was called (and thus where the R code was typed), and
bundles them in a quosure.

Another useful function is \href{http://rlang.tidyverse.org/reference/quosure.html}{\texttt{quos()}}, it
returns a list of quosures. You can supply several expressions directly, e.g.
\texttt{quos(foo,\ bar)}, but more importantly you can also supply dots: \texttt{quos(...)}.

Note that quosures don't make a lower level distinction between calls and names. Every
expression becomes a quosure.

To evaluate quosures we need a special function to implement the environment scoping
properly. \texttt{rlang} provides such a function:
\href{rlang.tidyverse.org/reference/eval_tidy.html}{\texttt{eval\_tidy()}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{10}

\KeywordTok{quo}\NormalTok{(x) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{eval_tidy}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quo}\NormalTok{(}\KeywordTok{mean}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{eval_tidy}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5.5
\end{verbatim}

\hypertarget{parsing-and-deparsing-1}{%
\subsubsection{Parsing and Deparsing}\label{parsing-and-deparsing-1}}

\texttt{rlang} also provides functions for parsing and deparsing expressions. To turn a string
into an expression use:
- \href{http://rlang.tidyverse.org/reference/parse_expr.html}{\texttt{parse\_expr()}}, which works in
the same way as \texttt{parse(text\ =\ ...)}.
- \href{http://rlang.tidyverse.org/reference/parse_expr.html}{\texttt{parse\_quosure()}} to create a
quosure.

To turn an expression into a string, \texttt{rlang} provides two functions:
- \href{http://rlang.tidyverse.org/reference/expr_label.html}{\texttt{expr\_text()}} to turn an
expression into a string.
- \href{http://rlang.tidyverse.org/reference/expr_label.html}{\texttt{expr\_label()}} to produce a
string that is more suited to use as a label.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{friendly_eval <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(expr) \{}
  \KeywordTok{str_c}\NormalTok{(}\StringTok{"The value of "}\NormalTok{, }\KeywordTok{deparse}\NormalTok{(expr), }\StringTok{" is "}\NormalTok{, }\KeywordTok{eval}\NormalTok{(expr))}
\NormalTok{\}}

\KeywordTok{quote}\NormalTok{(}\DecValTok{8} \OperatorTok{+}\StringTok{ }\DecValTok{10}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{friendly_eval}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "The value of 8 + 10 is 18"
\end{verbatim}

\hypertarget{cheatsheets}{%
\chapter{Cheatsheets}\label{cheatsheets}}

\bibliography{book.bib,packages.bib}


\end{document}
